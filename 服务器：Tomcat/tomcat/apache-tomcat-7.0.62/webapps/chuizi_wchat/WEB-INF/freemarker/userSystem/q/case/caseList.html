<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="${ctx}/js/userSystem/css/base.css">
    <link rel="stylesheet" href="${ctx}/js/userSystem/css/server-show.css">
    <link rel="stylesheet" href="http://at.alicdn.com/t/font_436970_pap8r1pc6uz3erk9.css">
    <link rel="stylesheet" href="${ctx}/js/userSystem/img/sprite.css">
    <link rel="stylesheet" href="${ctx}/js/userSystem/css/animate.min.css">
</head>
<body>
<div class="main animated rotateInUpLeft">
    <form>
        <!--菜单选择-->
        <div id="menus">
            <ul class="menus-tab clearfix">
               	<li id="caseHtml">
                	参数设置
                </li>
                <li id="casegoryHtml">分类设置</li>
                <li id="caseListHtml" class="active-top">案例中心</li>
                
            </ul>
            <form class="form-horizontal" name="searchForm" id="searchForm" action="${ctx}/userSystem/case/list/pre" role="form"> 
            <input type="hidden" name="miniBinId" id="miniBinId" value="${(returnDatas.queryBean.miniBinId)!'1'}"/>
          	<input type="hidden" name="pageIndex" id="pageIndex" value="${(returnDatas.page.pageIndex)!'1'}"/>
	            <div class="fn-box clearfix">
	                <div class="fl">
	                    <span>案例名称</span>
	                    <input autocomplete="off" type="text" name="selectInfo" id="selectInfo" value="${(returnDatas.queryBean.selectInfo)!''}" placeholder="请输入案例名称">
	                </div>
	                <div class="fl">
		                <span>类型</span>
		                <select name="type" id="type">
		                	<option value=''>全部</option>
		                    <option value='1'>图文</option>
		                    <option value='2'>视频</option>
		                </select>
		            </div>
		            <div class="fl">
		                <span>分类</span>
		                <select name="categoryId" id="categoryId">
		                </select>
		            </div>
	                <button onclick="$('#pageIndex').val(1)"  class="btnH" href="javascript:mySubmitForm('searchForm');" id="search">查询</button>
	                <button class="btnH" href="javascript:mySubmitForm('searchForm');" id="searchPage" style="display: none;">分页查询</button>
	                <button class="btnD">重置</button>
	            </div>
            </form>
        </div>
        <div style="height: 12px"></div>
        <div class="tab-box">
            <ul class="mainS">
                <!--案例中心-->
                <li  id="mode-cen">
               
                    <div class="btn-b caseListAddHtml" style="margin: 10px 0 20px;">新增</div>

                    <table>
                        <tr>
                            <th width="150">操作</th>
                            <th width="100">案例名称</th>
                            <th width="150">简介</th>
                            <th width="100">创建时间</th>
                            <th width="100">查看量</th>
                            <th width="100">排序</th>
                            <th width="100">大图</th>
                            <th width="100">分类</th>
                            <th width="100">是否推荐</th>
                            <th width="100">类型</th>
                            <th width="100">案列评论</th>
                        </tr>
                        <#if (returnDatas.data??)&&(returnDatas.data?size>0)>
					                <#list returnDatas.data as _data>
                        <tr>
                            <td >
									<a href="#"  class="btn btn-danger btn-xs" itemId="${_data.id}">删除 </a>
									<a href="#" updateItemId="${_data.id}" class="btn btn-primary btn-xs caseListAddHtml" data-target=" ">编辑</a>
								</td>
                            <td>${(_data.title)!''}</td>
                            <td>${(_data.descr)!''}</td>
                            <td>${(_data.createTime)!''}</td>
                            <td>${(_data.lookNum)!''}</td>
                            <td>${(_data.sorts)!0}</td>
                            <td><img style="width: 300px;height: 150px;" src="${(_data.icon)!''}"></td>
                            <th width="100">${(_data.categoryName)!''}</th>
                            <td ><#if _data.isRecommend??><#if _data.isRecommend==1><i itemId="${(_data.id)!''}" class="iconfont active">&#xe601;</i><#else><i itemId="${(_data.id)!''}" class="iconfont">&#xe601;</i></#if><#else><i itemId="${(_data.id)!''}" class="iconfont">&#xe601;</i></#if></td>
                            <td ><#if _data.type??><#if _data.type==1>图文<#else>视频</#if></#if></td>
                            <td><span class="edt1" itemId="${(_data.id)!''}">查看评论</span></td>
                        </tr>
                       				 </#list>
						</#if>
                    </table>
                    <div class="pages clearfix">
                        <div id="pagination" class="pages-list">
                        </div>
                    </div>
                    <!--新增-->
  
                </li>
            </ul>
        </div>
    </form>
    
    <!--是否删除弹窗-->
    <div class="alert-warn-box" id="rem">
        <div class="alert-warn cen">
            <h4>是否确认进行删除？删除后不可进行恢复。</h4>
            <div class="btn-box clearfix" style="margin-left: 0;">
                <div class="oks fl" onclick="deleteInfo();">
                    确定
                </div>
                <div class="cancel fr" onclick="javascript:$('.alert-warn-box').toggle()">
                    取消
                </div>
            </div>
        </div>
    </div>
    
    <!--查看评论-->
    <div class="alert-warn-box commendTmpl">
         <div class="type-main cen">
            <div class="close-type iconfont icon-guanbi1" onclick="javascript:$('.commendTmpl').toggle()"></div>
            <h3>评论列表</h3>
            <table id="caseList">
                
                
                
            </table>
            <div id="pagination1" class="pages-list" style="margin:20px 0;">
            </div>
        </div> 
    </div>
    <script id="case_list_tmpl" type="text/x-jquery-tmpl">
						<tr>
              					
                          		<td > <a href="#"  onclick="commendDel({{= id}});">删除</a></td>
								<td >
										{{= content}}
								</td>
								<td >
										{{= createTime}}
								</td>
								
								<td >
										{{= stars}}
								</td>
								
								<td >
										{{= userName}}
								</td>
								
								<td >
										<img style="width: 300px;height: 150px;" src="{{= image}}">
								</td>
								
								
								
								
            			</tr>
	</script>
    <script id="case_top_tmpl" type="text/x-jquery-tmpl">
						<tr>
                           		<th id="delll">删除</th>
								<th id="th_position" >评论内容</th>
								<th id="th_itemId" >评论时间</th>
								 <th id="th_url" >评论星级</th>
								<th id="th_cityId" >评论人</th>
								<th id="th_cityId" >评论图片</th>
                       	 </tr>
	</script>
</div>
</body>
<script src="${ctx}/js/userSystem/lib/jquery-1.8.3.min.js"></script>
<script src="${ctx}/js/userSystem/lib/jquery.pagination.min.js"></script>
<script src="${ctx}/js/userSystem/js/pulic.js"></script>
<script src="${ctx}/js/userSystem/lib/jquery.tmpl.min.js"></script>

<script>
    $(function () {
          $("ul.menus-tab li").on("click",function () {
            $(this).addClass("active-top").siblings().removeClass("active-top");
            $("ul.mainS li").eq($(this).index()).show().siblings().hide();
            $("form").each(function (item) {
                this.reset()
            });
            $(".add-txt").hide().siblings().show()
        });
        //        页码
	    $("#pagination").pagination({
	        currentPage:${(returnDatas.page.pageIndex)!1},// 当前页数
	        totalPage:${(returnDatas.page.pageCount)!1},// 总页数
	        count: 5,// 显示个数
	        callback: function (num) {
	        	$("#pageIndex").val(num);
	        	$("#searchPage").click();
	        }
	    });
        /*$(".btn-b").on("click",function () {
            $(this).siblings('.add-txt').show().siblings().hide();
        })*/

        $(".mode-add .oks").click(function () {
            $(".mode-add").toggle().siblings().toggle();
            alert("提交")
        });
        $("#cen-add").click(function () {
            $("#mode-cen .add-txt").toggle().siblings().toggle();
            alert("提交")
        });
        $("table td i").click(function () {
        	$(this).toggleClass("active");
        	$.ajax({
				url : '/chuizi_wchat/system/qcase/isRecommend/json?id='+id,
				type : "get",
				success : function(result){
					$("#searchPage").click();
				},
				error:function(XMLHttpRequest,textStatus,errorThrown){
					console.log(XMLHttpRequest);
					console.log(textStatus);
				}
			});
        	
   		});
   		
   		
   		
   		$(".btn-danger").on("click",function(){
    	$("#rem").toggle();
    	$("#rem").attr("itemId",$(this).attr("itemId"));
   			 });
   		
   		//查询下拉单
   		selectInfo("/chuizi_wchat/system/qcasecategory/list/json?pageSize=1000&miniBinId="+getCookie('miniBinId'),"categoryId",${(returnDatas.queryBean.categoryId)!''});
   		
   		//回选 下拉框
		jQuery("#type option[value='${(returnDatas.queryBean.type)!''}']").prop("selected",true);
        
        //评论
   		$(".edt1").click(function () {
            $(".commendTmpl").toggle();
            caseList($(this).attr("itemId"),1);
            
            
        });
       
   		
    })
    //删除按钮
        function deleteInfo(){
       
        
        	$.ajax({
				url : '/chuizi_wchat/userSystem/case/del/more?id='+$("#rem").attr("itemId"),
				type : "get",
				success : function(result){
					$("#searchPage").click();
				},
				error:function(XMLHttpRequest,textStatus,errorThrown){
					console.log(XMLHttpRequest);
					console.log(textStatus);
				}
			});
        
        }
        
        
        
         function caseList(itemId,num){
	        $.ajax({
				url : '/chuizi_wchat/system/qcasecommend/commendlist/json?caseId='+itemId+'&pageIndex='+num+'&pageSize=5',
				type : "get",
				dataType : "json",
				success : function(result){
					if(result.data!=undefined){
						$('#caseList').html("");
						$('#case_top_tmpl').tmpl(result.data[int]).appendTo($('#caseList'));
						for (var int = 0; int < result.data.length; int++){
							
							$('#case_list_tmpl').tmpl(result.data[int]).appendTo($('#caseList'));
							
						}
						
						$("#pagination1").pagination({
				            currentPage:result.page.pageIndex,// 当前页数
					        totalPage:result.page.pageCount,// 总页数
					        count: 5,// 显示个数
					        callback: function (num) {
					        	$("#pageIndex").val(num);
					        	caseList(itemId,num);
					        }
				        });
						
					}
					
				},
				error:function(XMLHttpRequest, textStatus, errorThrown){
					
					console.log(XMLHttpRequest);
					
					console.log(textStatus);
					
				}
			});
        
        }
        //删除按钮
        function commendDel(id){
         if(confirm("是否删除？")){
				$.ajax({
				url : '/chuizi_wchat/userSystem/qcasecommend/del/more?id='+id,
				type : "get",
				success : function(result){
				
				caseList($(".edt1").attr("itemId"),1);
					
				},
				error:function(XMLHttpRequest,textStatus,errorThrown){
					console.log(XMLHttpRequest);
					console.log(textStatus);
				}
			});
			}
        	
        
        }
        
        
</script>
</html>