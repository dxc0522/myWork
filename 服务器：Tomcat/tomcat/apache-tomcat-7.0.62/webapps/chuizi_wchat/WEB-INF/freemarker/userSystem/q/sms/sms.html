<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="${ctx}/js/userSystem/css/base.css">
    <link rel="stylesheet" href="${ctx}/js/userSystem/css/server-show.css">
    <link rel="stylesheet" href="http://at.alicdn.com/t/font_436970_7zkkyo61s6c7hkt9.css">
    <link rel="stylesheet" href="${ctx}/js/userSystem/img/sprite.css">
    <link rel="stylesheet" href="${ctx}/js/userSystem/css/animate.min.css">
</head>
<body>
<div class="main animated rotateInUpLeft note">
    <!--菜单选择-->
    <div id="menus">
        <ul class="menus-tab clearfix">
            <li class="active-top">
                短信群发
            </li>
        </ul>
        <form class="form-horizontal" name="searchForm" id="searchForm" action="${ctx}/userSystem/qsmstmpl/list/pre" role="form"> 
        <input type="hidden" name="miniBinId" id="miniBinId" value="${(returnDatas.queryBean.miniBinId)!'1'}"/>
        <input type="hidden" name="pageIndex" id="pageIndex" value="${(returnDatas.page.pageIndex)!'1'}"/>
        
	        <div class="fn-box clearfix">
	            <div class="fl">
	                <span>内容</span>
	                <input autocomplete="off" type="text" name="content" id="content" value="${(returnDatas.queryBean.content)!''}" placeholder="请输入内容">
	            </div>
	            <button onclick="$('#pageIndex').val(1)"  class="btnH" href="javascript:mySubmitForm('searchForm');" id="search">查询</button>
	            <button class="btnH" href="javascript:mySubmitForm('searchForm');" id="searchPage" style="display: none;">分页查询</button>
	            <button class="btnD">重置</button>
	        </div>
        </form>
    </div>
    <div style="height: 12px"></div>
    <!--主要内容-->
    <ul class="mainS">
        <li>
            <div class="btn-b" style="margin: 10px 0 20px;">新增</div>
            <table>
                <tr>
                    <th width="100">ID</th>
                    <th>发送内容</th>
                    <th width="150">发送日期</th>
                    <th width="200">发送类型</th>
                    <th width="100">操作</th>
                </tr>
                <#if (returnDatas.data??)&&(returnDatas.data?size>0)>
					<#list returnDatas.data as _data>
	                <tr>
	                    <td>${(_data.id)!''}</td>
	                    <td>${(_data.content)!''}</td>
	                    <td>${(_data.createTime)!''}</td>
	                    <td>全部</td>
	                    <td><span class="edt" itemId="${(_data.id)!''}">查看状态</span></td>
	                </tr>
                	</#list>
				</#if>
            </table>
            <div class="pages clearfix">
                <div id="pagination" class="pages-list">
                </div>
            </div>
            <!--新建-->
            <div class="add-txt">
                <div class="mainM">
                    <h3>发送类型：<span>全部发送</span></h3>
                    <p><span>* </span>发送内容</p>
                    <textarea placeholder="请输入短信内容" style="height: 130px;"></textarea>
                    <div class="add-type">
                        <b>本次发送条数:</b><em style="color:#00a0e2"><span>125</span>条</em>　　
                        <b>剩余条数:</b><em><span>125</span>条</em>
                    </div>
                    <div class="btn-box clearfix">
                        <div class="oks fl">
                            发送
                        </div>
                        <div class="cancel fl" onclick="javascript:$(this).parents('.add-txt').hide().siblings().show()">
                            取消
                        </div>
                    </div>
                </div>
            </div>
        </li>
    </ul>
    <!--查看状态-->
    <div class="alert-warn-box">
        <div class="type-main cen">
            <div class="close-type iconfont icon-guanbi1" onclick="javascript:$('.alert-warn-box').toggle()"></div>
            <h3>发送状态</h3>
            <div class="fn-box clearfix">
            
            	<div class="fl">
                <span>用户昵称</span>
                <input autocomplete="off" id="userNameDis" name="userNameDis" type="text" placeholder="请输入用户昵称" value="${(returnDatas.queryBean.userNameDis)!''}">
                </div>
            <button onclick="$('#pageIndex').val(1);"  class="btnH fr"  id="searchDis">查询</button>
            <button class="btnH fr"  id="searchPageDis" style="display: none;">分页查询</button>
            <button class="btnD fr">重置</button>
            </div>
            <table id="smsList">
                
                
                
            </table>
                      <div id="pagination1" class="pages-list">
                      </div>
        </div>
    </div>
    
    <script id="sms_list_tmpl" type="text/x-jquery-tmpl">
			<tr>
                <td>{{= userName}}</td>
                <td>{{= phone}}</td>
                <td>{{= createTime}}</td>
                <td><i class="iconfont icon-duihao"></i><b>发送成功</b></td>
            </tr>
	</script>
    <script id="sms_top_tmpl" type="text/x-jquery-tmpl">
			<tr><th>用户昵称</th><th>发送手机号</th><th>发送时间</th><th>发送状态</th></tr>
	</script>
    
</div>
</body>
<script src="${ctx}/js/userSystem/lib/jquery-1.8.3.min.js"></script>
<script src="${ctx}/js/userSystem/lib/jquery.pagination.min.js"></script>
<script src="${ctx}/js/userSystem/lib/jquery.tmpl.min.js"></script>
<input type="hidden" name="pageIndex1" id="pageIndex1" value="1"/>
<script>
    $(function () {
        $(".btn-b").on("click",function () {
            $(this).siblings('.add-txt').show().siblings().hide();
        });
         //        页码
	    $("#pagination").pagination({
	        currentPage:${(returnDatas.page.pageIndex)!1},// 当前页数
	        totalPage:${(returnDatas.page.pageCount)!1},// 总页数
	        count: 5,// 显示个数
	        callback: function (num) {
	        	$("#pageIndex").val(num);
	        	$("#searchPage").click();
	        }
	    });
        
       
        $(".add .oks").click(function () {
            $('.add').toggle().siblings().not('h2').toggle();
            alert("发送")
        });
       
        
    });
     $(".edt").click(function () {
            $(".alert-warn-box").toggle();
            $("#searchDis").attr("itemId",$(this).attr("itemId"));
         
            smsList($(this).attr("itemId"),1);
            
        });
    
     $("#searchDis").click(function () {
        smsList($(this).attr("itemId"),1);
   		 });
        
        function smsList(itemId,num){
        var url1='';
        
        if($("#userNameDis").val()!=undefined){
    		url1=url1+"&userNameDis="+$("#userNameDis").val();
    	
    	}
        
	        $.ajax({
				url : '/chuizi_wchat/system/qsmspush/list/json?itemId='+itemId+'&pageIndex='+num+url1+'&pageSize=5',
				type : "get",
				dataType : "json",
				success : function(result){
					if(result.data!=undefined){
						$('#smsList').html("");
						$('#sms_top_tmpl').tmpl(result.data[int]).appendTo($('#smsList'));
						for (var int = 0; int < result.data.length; int++){
							
							$('#sms_list_tmpl').tmpl(result.data[int]).appendTo($('#smsList'));
							
						}
						$("#pageIndex1").val(result.page.pageIndex);
						$("#pagination1").pagination({
				            currentPage:result.page.pageIndex,// 当前页数
					        totalPage:result.page.pageCount,// 总页数
					        count: 5,// 显示个数
					        callback: function (num) {
					        	$("#pageIndex1").val(num);
					        	smsList(itemId,num);
					        }
				        });
						
					}
					
				},
				error:function(XMLHttpRequest, textStatus, errorThrown){
					
					console.log(XMLHttpRequest);
					
					console.log(textStatus);
					
				}
			});
        
        }

</script>
</html>