<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="${ctx}/js/userSystem/css/base.css">
    <link rel="stylesheet" href="${ctx}/js/userSystem/css/server-show.css">
    <link rel="stylesheet" href="http://at.alicdn.com/t/font_436970_pap8r1pc6uz3erk9.css">
    <link rel="stylesheet" href="${ctx}/js/userSystem/img/sprite.css">
    <link rel="stylesheet" href="${ctx}/js/userSystem/css/animate.min.css">
</head>
<body>
<div class="main animated rotateInUpLeft">
    <form >
        <!--菜单选择-->
        <div id="menus">
            <ul class="menus-tab clearfix">
                <li id="goodHtml" >
                    参数设置
                </li>
                <li id="goodCategory">
                    分类设置
                </li>
                <li class="active-top" id="goodsId">
                    产品中心
                </li >
            </ul>
            
            <form class="form-horizontal" name="searchForm" id="searchForm" action="/chuizi_wchat/userSystem/good/list/pre" role="form"> 
          <input type="hidden" name="miniBinId" id="miniBinId" value="${(returnDatas.queryBean.miniBinId)!'1'}"/>
           <input type="hidden" name="pageIndex" id="pageIndex" value="${(returnDatas.page.pageIndex)!'1'}"/>
       	 <div class="fn-box clearfix">
            <div class="fl">
                <span>产品名称</span>
                <input autocomplete="off" name="selectInfo" type="text" placeholder="请输入产品名称" value="${(returnDatas.queryBean.selectInfo)!''}">
                </div>
                <div class="fl">
		                <span>星级</span>
		                <select name="stars" id="type">
		                	<option value=''>全部</option>
		                    <option value='1'>1</option>
		                    <option value='2'>2</option>
		                    <option value='3'>3</option>
		                    <option value='4'>4</option>
		                    <option value='5'>5</option>
		                </select>
		            </div>
		            <div class="fl">
		                <span>分类</span>
		                <select name="categoryId" id="categoryId">
		                </select>
		            </div>
            
            <button onclick="$('#pageIndex').val(1)"  class="btnH" href="javascript:mySubmitForm('searchForm');" id="search">查询</button>
            <button class="btnH" href="javascript:mySubmitForm('searchForm');" id="searchPage" style="display: none;">分页查询</button>
            <button class="btnD">重置</button>
        </div>
        </form>
        </div>
        <div style="height: 12px"></div>
        <ul class="mainS">
            <li>
                <div class="btn-b goodListAddHtml" style="margin: 10px 0 20px;">新增</div>
                
                
                 <table>
                      
						<tr>
						 <!--first_start_no_export-->
						 <!--first_end_no_export-->
								<th id="th_cityId" >操作</th>
								<th id="th_position" >产品标题</th>
								<th id="th_itemId" >产品图片</th>
								 <th id="th_url" >原价</th>
								<th id="th_cityId" >现价</th>
								<th id="th_cityId" >销量</th>
								<th id="th_cityId" >库存</th>
								<th id="th_cityId" >分类名称</th>
								<th id="th_cityId" >是否推荐到首页</th>
								<th id="th_cityId" >星级</th>
								<th width="100">产品评论</th>
						</tr>
					
					
                   

				        <#if (returnDatas.data??)&&(returnDatas.data?size>0)>
		                <#list returnDatas.data as _data>
						 
							<tr id="${_data.id}">
							
							
								<td >
										<a href="#"  class="btn btn-danger btn-xs" itemId="${_data.id}">删除 </a>
										<a href="#" updateItemId="${_data.id}" class="btn btn-primary btn-xs goodListAddHtml" data-target=" ">编辑</a>
								</td>
								<td >
										${(_data.title)!''}
								</td>
								<td >
										<img style="width: 300px;height: 150px;" src="${(_data.image)!''}">
								</td>
								
								
								<td >
										${(_data.oldMoney)!''}
								</td>
								
								<td >
										${(_data.money)!''}
								</td>
								
								<td >
										${(_data.shellNum)!''}
								</td>
								<td >
										${(_data.num)!''}
								</td>
								
								<td >
										${(_data.categoryName)!''}
								</td>
								
								 <td ><#if _data.isRecommend??><#if _data.isRecommend==1><i itemId="${(_data.id)!''}" class="iconfont active">&#xe601;</i><#else><i itemId="${(_data.id)!''}" class="iconfont">&#xe601;</i></#if></#if></td>
								
								<td >
										${(_data.stars)!''}
								</td>
								  <td><span class="edt1" itemId="${(_data.id)!''}">查看评论</span></td>
								
							</tr>
							
						</#list>
						 </#if>
						
                </table>
                <div class="pages clearfix">
                    <div id="pagination" class="pages-list">
                    </div>
                </div>
                <!--新增产品-->

            </li>
        </ul>
    </form>
    <!--是否删除弹窗-->
    <div class="alert-warn-box" id="rem">
        <div class="alert-warn cen">
            <h4>是否确认进行删除？删除后不可进行恢复。</h4>
            <div class="btn-box clearfix" style="margin-left: 0;">
                <div class="oks fl" onclick="deleteInfo();">
                    确定
                </div>
                <div class="cancel fr" onclick="javascript:$('.alert-warn-box').toggle()">
                    取消
                </div>
            </div>
        </div>
    </div>
    
    
    <!--查看评论-->
    <div class="alert-warn-box commendTmpl">
         <div class="type-main cen">
            <div class="close-type iconfont icon-guanbi1" onclick="javascript:$('.commendTmpl').toggle()"></div>
            <h3>评论列表</h3>
            <table id="commendList">
                
                
                
            </table>
            <div id="pagination1" class="pages-list" style="margin:20px 0;">
            </div>
        </div> 
    </div>
    <script id="commend_list_tmpl" type="text/x-jquery-tmpl">
						<tr>
              					
                          		<td > <a href="#"  onclick="commendDel({{= goodId}},{{= id}});">删除</a></td>
								<td >
										{{= content}}
								</td>
								<td >
										{{= createTime}}
								</td>
								
								<td >
										{{= stars}}
								</td>
								
								<td >
										{{= userName}}
								</td>
								
								<td >
										<img style="width: 300px;height: 150px;" src="{{= image}}">
								</td>
								
								
								
								
            			</tr>
	</script>
    <script id="commend_top_tmpl" type="text/x-jquery-tmpl">
						<tr>
                           		<th id="delll">删除</th>
								<th id="th_position" >评论内容</th>
								<th id="th_itemId" >评论时间</th>
								 <th id="th_url" >评论星级</th>
								<th id="th_cityId" >评论人</th>
								<th id="th_cityId" >评论图片</th>
                       	 </tr>
	</script>
</div>
</body>
<script src="${ctx}/js/userSystem/lib/jquery-1.8.3.min.js"></script>
<script src="${ctx}/js/userSystem/lib/My97DatePicker/WdatePicker.js"></script>
<script src="${ctx}/js/userSystem/lib/jquery.pagination.min.js"></script>
<script src="${ctx}/js/userSystem/js/pulic.js"></script>
<script src="${ctx}/js/userSystem/lib/jquery.tmpl.min.js"></script>
<input type="hidden" name="pageIndex1" id="pageIndex1" value="1"/>
<script>
    $(function () {
        $("ul.menus-tab li").on("click",function () {
            $(this).addClass("active-top").siblings().removeClass("active-top");
            $("ul.mainS li").eq($(this).index()).show().siblings().hide();
            $("form").each(function (item) {
                this.reset()
            });
            $(".add-txt").hide().siblings().show()
        });
        $(".btn-b").on("click",function () {
            $(this).siblings('.add-txt').show().siblings().hide();
        });
        //        页码
    $("#pagination").pagination({
        currentPage:${(returnDatas.page.pageIndex)!1},// 当前页数
        totalPage:${(returnDatas.page.pageCount)!1},// 总页数
        count: 5,// 显示个数
        callback: function (num) {
        	$("#pageIndex").val(num);
        	$("#searchPage").click();
        }
    });
       
        $(".mode-add .oks").click(function () {
            $(this).parents(".mode-add").toggle().siblings().toggle();
            alert("添加");
        });
        $(".addT .oks").click(function () {
            $('.addT .add-txt').toggle().siblings().toggle();
            alert("提交");
        });
        
         $("table td i").click(function () {
        	$(this).toggleClass("active");
        	$.ajax({
				url : '/chuizi_wchat/system/qgood/isRecommend/json?id='+$(this).attr("itemId"),
				type : "get",
				success : function(result){
					$("#searchPage").click();
				},
				error:function(XMLHttpRequest,textStatus,errorThrown){
					console.log(XMLHttpRequest);
					console.log(textStatus);
				}
			});
        	
   		});
   		 $(".btn-danger").on("click",function(){
    	$("#rem").toggle();
    	$("#rem").attr("itemId",$(this).attr("itemId"));
    });
   
        
        //查询下拉单
   		selectInfo("/chuizi_wchat/system/qgoodcategory/list/json?pageSize=1000&miniBinId="+getCookie('miniBinId'),"categoryId",${(returnDatas.queryBean.categoryId)!''});
   		
   		//回选 下拉框
		jQuery("#type option[value='${(returnDatas.queryBean.stars)!''}']").prop("selected",true);
		
		 //评论按钮
   		$(".edt1").click(function () {
            $(".commendTmpl").toggle();
            goodList($(this).attr("itemId"),1);
            
            
        });
       
    })
    
    
     function goodList(itemId,num){
	        $.ajax({
				url : '/chuizi_wchat/userSystem/qgoodcommend/list/pre?goodId='+itemId+'&pageIndex='+num+'&pageSize=5',
				type : "get",
				dataType : "json",
				success : function(result){
					if(result.data!=undefined){
						$('#commendList').html("");
						$('#commend_top_tmpl').tmpl(result.data[int]).appendTo($('#commendList'));
						for (var int = 0; int < result.data.length; int++){
							
							$('#commend_list_tmpl').tmpl(result.data[int]).appendTo($('#commendList'));
							
						}
						//$("#pageIndex1").val(result.page.pageIndex);
						
						$("#pagination1").pagination({
				            currentPage:result.page.pageIndex,// 当前页数
					        totalPage:result.page.pageCount,// 总页数
					        count: 5,// 显示个数
					        callback: function (num) {
					        	$("#pageIndex1").val(num);
					        	goodList(itemId,num);
					        }
				        });
						
					}
					
				},
				error:function(XMLHttpRequest, textStatus, errorThrown){
					
					console.log(XMLHttpRequest);
					
					console.log(textStatus);
					
				}
			});
        
        }
     //删除按钮
        function deleteInfo(){
        
        	$.ajax({
				url : '/chuizi_wchat/userSystem/good/del/more?id='+$("#rem").attr("itemId"),
				type : "get",
				success : function(result){
					$("#searchPage").click();
				},
				error:function(XMLHttpRequest,textStatus,errorThrown){
					console.log(XMLHttpRequest);
					console.log(textStatus);
				}
			});
        
        }
        
        //删除按钮
        function commendDel(itemId,id){
         if(confirm("是否删除？")){
				$.ajax({
				url : '/chuizi_wchat/userSystem/qgoodcommend/del/more?id='+id,
				type : "get",
				success : function(result){
					goodList($(".edt1").attr("itemId"),1);
				},
				error:function(XMLHttpRequest,textStatus,errorThrown){
					console.log(XMLHttpRequest);
					console.log(textStatus);
				}
			});
			}
        	
        
        }
</script>
</html>