<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="${ctx}/js/userSystem/css/base.css">
    <link rel="stylesheet" href="${ctx}/js/userSystem/css/server-show.css">
    <link rel="stylesheet" href="http://at.alicdn.com/t/font_436970_pap8r1pc6uz3erk9.css">
</head>
<body>
<div class="main animated rotateInUpLeft">
    <!--菜单选择-->
    <div id="menus">
        <ul class="menus-tab clearfix">
            <li class="orderHtml" status="0">
               待支付
            </li>
            <li class="orderHtml" status="1">
                待发货
            </li>
            <li class="orderHtml" status="2">
               待收货
            </li>
            <li class="orderHtml" status="3">
                待评价
            </li>
            <li class="orderHtml" status="4">
               已完成
            </li>
        </ul>
        <div class="fn-box clearfix">
         <form class="form-horizontal" name="searchForm" id="searchForm" action="${ctx}/userSystem/qorder/list/pre" role="form"> 
         	<input type="hidden" name="miniBinId" id="miniBinId" value="${(returnDatas.queryBean.miniBinId)!'1'}"/>
          	<input type="hidden" name="pageIndex" id="pageIndex" value="${(returnDatas.page.pageIndex)!'1'}"/>
          	<input type="hidden" name="status" id="status" value="${(returnDatas.queryBean.status)!'1'}"/>
            <div class="fl">
                <span>付款方式</span>
                <select  name="payType" id="payType">
                	<option value="">全部</option>
                    <option value="1">支付宝</option>
                    <option value="2">微信</option>
                    <option value="3">余额</option>
                </select>
            </div>
            
            <div class="fl">
                <span>订单编号</span>
                <input type="text" name="code" value="${(returnDatas.queryBean.code)!''}" placeholder="请输入订单编号">
            </div>
            
            <button onclick="$('#pageIndex').val(1)"  class="btnH" href="javascript:mySubmitForm('searchForm');" id="search">查询</button>
	        <button class="btnH" href="javascript:mySubmitForm('searchForm');" id="searchPage" style="display: none;">分页查询</button>
	        <button class="btnD">重置</button>
	        
          </form>
        </div>
    </div>
    <div style="height: 12px"></div>
    <!--主要内容-->
    <ul class="mainS">
        <li>
            <table>
                <tr>
                	<th style="width: 300px;">操作</th>
                    <th>编号</th>
                    <th>会员昵称</th>
                    <th>手机号</th>
                    <th>地址</th>
                    <th>商品</th>
                    <th>金额</th>
                    <th>优惠卷</th>
                    <th>优惠卷抵用金额</th>
                    <th>付款方式</th>
                    <th>物流公司</th>
                    <th>物流单号</th>
                </tr>
                
                <#if (returnDatas.data??)&&(returnDatas.data?size>0)>
					<#list returnDatas.data as _data>
		                <tr>
		                	<td><#if _data.status==0><span class="rem" itemId="${(_data.id)!''}">修改金额</span><#elseif _data.status==2><span class="rem1 send" itemId="${(_data.id)!''}">发货</span><#elseif _data.payType==4><span class="edt" itemId="${(_data.id)!''}">查看评论</span></#if></td>
		                    <td>${(_data.code)!''}</td>
		                    <td>${(_data.userName)!''}</td>
		                    <td>${(_data.addrPhone)!''}</td>
		                    <td>${(_data.address)!''}</td>
		                    <td>${(_data.goodTitle)!''}</td>
		                    <td>${(_data.money)!''}</td>
		                    <td>${(_data.cardTitle)!''}</td>
		                    <td>${(_data.cardMoney)!''}</td>
		                    <td><#if _data.payType==1>支付宝<#elseif _data.payType==2>微信<#elseif _data.payType==3>余额</#if></td>
		                    <td>${(_data.expressage)!''}</td>
		                    <td>${(_data.expressageCode)!''}</td>
		                </tr>
                	 </#list>
				</#if>
            </table>
            <div class="pages clearfix">
                <div id="pagination" class="pages-list">
                </div>
            </div>
        </li>
        
        
        
        <!--查看状态-->
	    <div class="alert-warn-box commend">
	        <div class="type-main cen">
	            <div class="close-type iconfont icon-guanbi1" onclick="javascript:$('.commend').toggle()"></div>
	            <h3>评论内容</h3>
	            <table id="commendList">
	                

	            </table>
	            <div id="pagination1" class="pages-list" style="margin:20px 0;">
	            </div>
	        </div>
	    </div>
	    
	    <script id="commend_list_tmpl" type="text/x-jquery-tmpl">
			<tr>
                <td>{{= userName}}</td>
                <td>{{= content}}</td>
				<td><img style="width: 150px;height: 150px;" src="{{= image}}"></td>
				<td>{{= stars}}</td>
                <td>{{= createTime}}</td>
                <td>{{if type==1 }}用户{{else}}商家{{/if}}</td>
            </tr>
	</script>
	    <script id="commend_top_tmpl" type="text/x-jquery-tmpl">
			<tr><th>用户昵称</th><th>评论内容</th><th>评论图片</th><th>评论星级</th><th>评论时间</th><th>发送人</th></tr>
	</script>
        
        <div class="alert-warn-box money">
                        <div class="cue cen" style="height: auto;padding-bottom: 20px">
                            <h3 style="border:none">提示</h3>
                            <input type="text" placeholder="请输入订单金额：" id="moneyInput" style="width: 80%;margin-bottom: 20px;background-color: #f6f6f6;">
                            <div class="btn-box clearfix" style="margin:0;margin-left: 56px;">
                                <div class="oks fl" onclick="updateMoney();">
                                    确定
                                </div>
                                <div class="cancel fl"  onclick="javascript:$('.money').toggle()">
                                    取消
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    
                    <div class="alert-warn-box send">
                        <div class="cue cen" style="height: auto;padding-bottom: 20px">
                            <h3 style="border:none">请填写物流信息</h3>
                            <input type="text" id="expressage" placeholder="请输入物流公司：" style="width: 90%;margin-bottom: 20px;background-color: #f6f6f6;">
                            <input type="text" id="expressageCode" placeholder="请输入物流单号：" style="width: 90%;margin-bottom: 20px;background-color: #f6f6f6;">
                            <div class="btn-box clearfix" style="margin:0;margin-left: 56px;">
                                <div class="oks fl" onclick="send();">
                                    确定
                                </div>
                                <div class="cancel fl"  onclick="javascript:$('.send').toggle()">
                                    取消
                                </div>
                            </div>
                        </div>
                    </div>
        
    </ul>
</div>
</body>
<script src="https://cdn.bootcss.com/jquery/1.12.2/jquery.min.js"></script>
<script src="${ctx}/js/userSystem/lib/jquery.pagination.min.js"></script>
<script src="${ctx}/js/userSystem/js/pulic.js"></script>
<script src="${ctx}/js/userSystem/lib/jquery.tmpl.min.js"></script>
<script>
     	//     页码
	    $("#pagination").pagination({
	        currentPage:${(returnDatas.page.pageIndex)!1},// 当前页数
	        totalPage:${(returnDatas.page.pageCount)!1},// 总页数
	        count: 5,// 显示个数
	        callback: function (num) {
	        	
	        	$("#pageIndex").val(num);
	        	$("#searchPage").click();
	        	
	        }
	    });
    
    	var sta=${(returnDatas.queryBean.status)!'1'};
	    if(sta!=undefined){
			$(".menus-tab li[status='"+sta+"']").addClass("active-top");
	    }
	    //回选 下拉框
		jQuery("#payType option[value='${(returnDatas.queryBean.payType)!''}']").prop("selected",true);
		
		
		$(".edt").click(function () {
            $(".commend").toggle();
            commendList($(this).attr("itemId"),1);
            
        });
		
		function commendList(itemId,num){
        
	        $.ajax({
				url : '/chuizi_wchat/system/qgoodcommend/adminList/json?orderId='+itemId+'&pageIndex='+num,
				type : "post",
				dataType : "json",
				success : function(result){
					if(result.data!=undefined){
						$('#commendList').html("");
						$('#commend_top_tmpl').tmpl(result.data[int]).appendTo($('#commendList'));
						for (var int = 0; int < result.data.length; int++){
							
							$('#commend_list_tmpl').tmpl(result.data[int]).appendTo($('#commendList'));
							
						}
						
						$("#pagination1").pagination({
				            currentPage:${(result.page.pageIndex)!1},// 当前页数
					        totalPage:${(result.page.pageCount)!1},// 总页数
					        count: 5,// 显示个数
					        callback: function (num) {
					        	$("#pageIndex").val(num);
					        	commendList(itemId,num);
					        }
				        });
						
					}
					
				},
				error:function(XMLHttpRequest, textStatus, errorThrown){
					
					console.log(XMLHttpRequest);
					
					console.log(textStatus);
					
				}
			});
        
        }
		
		$(".rem").click(function () {
            $(".money").toggle();
            $(".money").attr("itemId",$(this).attr("itemId"));
        });
		
		
		function updateMoney(){
        
	        $.ajax({
				url : '/chuizi_wchat/system/qorder/updateMoney/json?id='+$(".money").attr("itemId")+'&money='+$("#moneyInput").val(),
				type : "post",
				dataType : "json",
				success : function(result){
					$("#searchPage").click();
				},
				error:function(XMLHttpRequest, textStatus, errorThrown){
					
					console.log(XMLHttpRequest);
					
					console.log(textStatus);
					
				}
			});
        
        }
		
		
		$(".rem1").click(function () {
            $(".send").toggle();
            $(".send").attr("itemId",$(this).attr("itemId"));
        });
		
		
		function send(){
        
	        $.ajax({
				url : '/chuizi_wchat/system/qorder/send/json?id='+$(".send").attr("itemId")+'&expressage='+$("#expressage").val()+'&expressageCode='+$("#expressageCode").val(),
				type : "post",
				dataType : "json",
				success : function(result){
					$("#searchPage").click();
				},
				error:function(XMLHttpRequest, textStatus, errorThrown){
					
					console.log(XMLHttpRequest);
					
					console.log(textStatus);
					
				}
			});
        
        }
		
</script>
</html>